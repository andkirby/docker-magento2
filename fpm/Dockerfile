#
# This file is automatically generated. Do not edit directly.
#

ARG M2SETUP_PHP=7.1

FROM php:${M2SETUP_PHP}-fpm

MAINTAINER Nick Jones <nick@nicksays.co.uk>

ADD . /container-files

RUN true \

  # Install dependencies
  && apt-get update \
  && apt-get install -y \
    libfreetype6-dev \ 
    libicu-dev \ 
    libjpeg62-turbo-dev \ 
    libmcrypt-dev \ 
    libpng-dev \ 
    libxslt1-dev \ 
    ssmtp \
    sudo \

  # Configure the gd library
  && docker-php-ext-configure \
    gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \

  # Install required PHP extensions
  && docker-php-ext-install \
    dom \
    gd \
    intl \
    mbstring \
    pdo_mysql \
    xsl \
    zip \
    soap \
    bcmath \
    opcache \

  && pecl install mcrypt \
  && docker-php-ext-enable mcrypt \

  && pecl install apcu \
  && docker-php-ext-enable apcu \

  # Install Xdebug (but don't enable)
  && pecl install -o -f xdebug \
  && docker-php-ext-enable xdebug.so \
  && curl -Ls https://raw.github.com/rikby/xdebug-switcher/master/download | bash

RUN true \
  && cp /container-files/etc/php-fpm.ini    /usr/local/etc/php/conf.d/zz-magento.ini \
  && cp /container-files/etc/php-fpm.conf   /usr/local/etc/ \
  && cp /container-files/etc/php-xdebug.ini /usr/local/etc/php/conf.d/zz-xdebug-settings.ini \
  && cp /container-files/etc/php-opcache.ini /usr/local/etc/php/conf.d/zz-opcache.ini \
  && cp /container-files/etc/php-apc.ini /usr/local/etc/php/conf.d/zz-apc.ini \
  && cp /container-files/etc/mail.ini       /usr/local/etc/php/conf.d/zz-mail.ini \
  && cp /container-files/docker-entrypoint.sh /docker-entrypoint.sh \
  && rm -rf /container-files \
  && chmod +x /docker-entrypoint.sh \
  # disable xdebug
  && xd_swi off

# ENV PHP_MEMORY_LIMIT 2G
# ENV PHP_ENABLE_XDEBUG false
# ENV PHP_UPLOAD_MAX_FILESIZE 64M
# ENV MAGENTO_RUN_MODE developer
ENV MAGENTO_ROOT /var/www/magento
# ENV DEBUG false
# ENV UPDATE_UID_GID false

ENTRYPOINT ["/docker-entrypoint.sh"]

CMD ["php-fpm", "-F"]
